# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –±–æ—Ç–∞ "–î—É—Ö–æ–≤–Ω–∏–∫"

## üìä –û–±–∑–æ—Ä

–ë–æ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–æ–π –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –ó–∞–ø—É—Å–∫–æ–≤ –±–æ—Ç–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–∫—Ç–∏–≤–∞—Ü–∏–π –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
- –£—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π

## üîó UTM-—Ç—Ä–µ–∫–∏–Ω–≥ –∏ ClientID

### –ß—Ç–æ —Ç–∞–∫–æ–µ ClientID?

**ClientID** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–ª–∏–∫–∏ –ø–æ —Ä–µ–∫–ª–∞–º–µ, –ø–µ—Ä–µ—Ö–æ–¥—ã –≤ –±–æ—Ç, –∫–æ–Ω–≤–µ—Ä—Å–∏–∏).

### –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è ClientID?

1. **–ò–∑ UTM-–º–µ—Ç–æ–∫** (–ø–∞—Ä–∞–º–µ—Ç—Ä `yclid` –∏–ª–∏ `client_id`):
   - –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Ä–µ–∫–ª–∞–º–Ω–æ–π —Å—Å—ã–ª–∫–µ –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç, –≤ URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `yclid`
   - –ü—Ä–∏–º–µ—Ä: `https://t.me/yourbot?start=utm_source=yandex--yclid=1234567890`
   
2. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**:
   - –ï—Å–ª–∏ `yclid` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω, –±–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π ClientID –Ω–∞ –æ—Å–Ω–æ–≤–µ Telegram `user_id`
   - –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç—Ä–µ–∫–∏–Ω–≥ –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å UTM-—Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã?

–§–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏ –¥–ª—è Telegram:
```
https://t.me/yourbot?start=utm_source=yandex--utm_campaign=christmas--yclid={YCLID}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `utm_source` - –∏—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞ (yandex, vk, telegram, etc.)
- `utm_campaign` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ (christmas, easter, etc.)
- `utm_medium` - —Ç–∏–ø —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (cpc, banner, post)
- `yclid={YCLID}` - ClientID –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è)

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç:**
```
https://t.me/dukhovnik_ai_bot?start=utm_source=yandex--utm_campaign=new_year_2026--utm_medium=cpc--yclid={YCLID}
```

### –ö–∞–∫ ClientID —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏?

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —Ä–µ–∫–ª–∞–º—É –≤ –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç
2. –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–ª–∏–∫ —Å ClientID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –±–æ—Ç –ø–æ —Å—Å—ã–ª–∫–µ —Å `yclid`
4. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `yclid` –∫–∞–∫ `client_id` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
5. –ü—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ (–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏, –æ–ø–ª–∞—Ç–∞) –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—é —Å —Ç–µ–º –∂–µ ClientID
6. –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ —Å–≤—è–∑—ã–≤–∞–µ—Ç –∫–ª–∏–∫ –ø–æ —Ä–µ–∫–ª–∞–º–µ –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏—é ‚Üí **–º–æ–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å ROI**

## üîë –ü–æ–ª—É—á–µ–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞ –¥–ª—è Management API

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.OAuth

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://oauth.yandex.ru/
2. –ù–∞–∂–º–∏—Ç–µ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **–ù–∞–∑–≤–∞–Ω–∏–µ**: –î—É—Ö–æ–≤–Ω–∏–∫ –ë–æ—Ç Analytics
   - **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã
   - **Redirect URI**: https://oauth.yandex.ru/verification_code
4. –í —Ä–∞–∑–¥–µ–ª–µ **–î–æ—Å—Ç—É–ø—ã** –≤—ã–±–µ—Ä–∏—Ç–µ:
   - ‚úÖ `metrika:read` - —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—á—ë—Ç—á–∏–∫–∞
   - ‚úÖ `metrika:write` - –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏–π)
5. –ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Client ID**

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ URL (–∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_CLIENT_ID` –Ω–∞ –≤–∞—à Client ID):
   ```
   https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
   ```

2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ –Ø–Ω–¥–µ–∫—Å
3. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∫ –ú–µ—Ç—Ä–∏–∫–µ
4. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ URL –≤–∏–¥–∞:
   ```
   https://oauth.yandex.ru/verification_code#access_token=YOUR_TOKEN&...
   ```
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `access_token` - —ç—Ç–æ –∏ –µ—Å—Ç—å –≤–∞—à OAuth —Ç–æ–∫–µ–Ω

### –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ .env

```bash
YANDEX_METRIKA_TOKEN=YOUR_ACCESS_TOKEN_HERE
```

## üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–ª–µ–π –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ

–ó–∞–π–¥–∏—Ç–µ –≤ https://metrika.yandex.ru/dashboard?id=106602878

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –¶–µ–ª–∏ ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å

–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ü–µ–ª–∏:

| –ù–∞–∑–≤–∞–Ω–∏–µ | ID —Ü–µ–ª–∏ | –¢–∏–ø | –£—Å–ª–æ–≤–∏–µ |
|----------|---------|-----|---------|
| bot_start | 508977279 | JavaScript —Å–æ–±—ã—Ç–∏–µ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: `bot_start` |
| free_period_start | 508976625 | JavaScript —Å–æ–±—ã—Ç–∏–µ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: `free_period_start` |
| premium_payment | 508976841 | JavaScript —Å–æ–±—ã—Ç–∏–µ | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä: `premium_payment` |

## üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

### 1. bot_start (Goal ID: 508977279)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç `/start`
- `user_data['onboarded']` = `False` (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

**–î–∞–Ω–Ω—ã–µ:**
- ClientID: –∏–∑ UTM (`yclid`) –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –æ—Å–Ω–æ–≤–µ `user_id`
- Value: 0 RUB (–±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ)

**–ö–æ–¥:**
```python
# handlers/start.py
if is_new_user:
    client_id = user_data.get('client_id')
    if client_id:
        asyncio.create_task(send_offline_conversion_bot_start(client_id, user_id))
```

---

### 2. free_period_start (Goal ID: 508976625)

**–¢—Ä–∏–≥–≥–µ—Ä:** –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ (30 –¥–Ω–µ–π)

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 1 –º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
- Callback: `activate_free_period`

**–î–∞–Ω–Ω—ã–µ:**
- ClientID: –∏–∑ `user_data['client_id']` (UTM –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- Value: 0 RUB (–±–µ—Å–ø–ª–∞—Ç–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ)

**–ö–æ–¥:**
```python
# handlers/subscription.py ‚Üí activate_free_period_handler
client_id = user_data.get('client_id')
if client_id:
    asyncio.create_task(send_offline_conversion_free_period(client_id, user_id))
```

---

### 3. premium_payment (Goal ID: 508976841)

**–¢—Ä–∏–≥–≥–µ—Ä:** –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ Premium –ø–æ–¥–ø–∏—Å–∫–∏

**–ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—Ç–∏–ª –ø–æ–¥–ø–∏—Å–∫—É (1, 3 –∏–ª–∏ 12 –º–µ—Å—è—Ü–µ–≤)
- Telegram –≤—ã–∑–≤–∞–ª `successful_payment_handler`

**–î–∞–Ω–Ω—ã–µ:**
- ClientID: –∏–∑ `user_data['client_id']` (UTM –∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- Value: –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤ —Ä—É–±–ª—è—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, 149.00)
- Currency: RUB

**–ö–æ–¥:**
```python
# handlers/subscription.py ‚Üí successful_payment_handler
client_id = user_data.get('client_id')
if client_id:
    # payment_info.total_amount –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –∫–æ–ø–µ–π–∫–∞—Ö
    asyncio.create_task(send_offline_conversion_payment(client_id, user_id, payment_info.total_amount))
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏ –±–æ—Ç–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
tail -f /opt/dukhovnik_bot/bot.log | grep -E "–û—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—è|ClientID"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
2026-01-18 12:30:00 - ClientID —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è user_id=123456: 1234567890abcdef
2026-01-18 12:30:01 - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 123456 (@username) –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: utm_source=organic, ClientID=1234567890abcdef
2026-01-18 12:30:02 - ‚úÖ –ö–æ–Ω–≤–µ—Ä—Å–∏—è bot_start —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è user_id=123456, ClientID=1234567890abcdef
2026-01-18 12:30:03 - –û—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—è 508977279 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: user_id=123456, ClientID=1234567890abcdef, price=0.0 RUB
```

–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç —Å yclid:
```
2026-01-18 12:35:00 - ClientID –ø–æ–ª—É—á–µ–Ω –∏–∑ UTM –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è user_id=234567: 9876543210fedcba
2026-01-18 12:35:01 - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 234567 (@user2) –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: utm_source=yandex, utm_campaign=christmas, yclid=9876543210fedcba, ClientID=9876543210fedcba
```

–ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞:
```
2026-01-18 13:00:00 - –û—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—è free_period_start –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è user_id=123456, ClientID=1234567890abcdef
2026-01-18 13:00:01 - ‚úÖ –ö–æ–Ω–≤–µ—Ä—Å–∏—è free_period_start —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è user_id=123456, ClientID=1234567890abcdef
```

–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏:
```
2026-01-18 15:23:45 - –û—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—è premium_payment –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è user_id=123456, ClientID=1234567890abcdef, amount=149.0 RUB
2026-01-18 15:23:46 - ‚úÖ –ö–æ–Ω–≤–µ—Ä—Å–∏—è premium_payment —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –¥–ª—è user_id=123456, ClientID=1234567890abcdef, price=149.0 RUB
```

### –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞

1. –ó–∞–π–¥–∏—Ç–µ –≤ https://metrika.yandex.ru/dashboard?id=106602878
2. –û—Ç—á—ë—Ç—ã ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—á—ë—Ç—ã ‚Üí –ö–æ–Ω–≤–µ—Ä—Å–∏–∏
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:
   - **bot_start** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - **free_period_start** - –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
   - **premium_payment** - –ø–ª–∞—Ç–µ–∂–∏ —Å —Å—É–º–º–∞–º–∏

### API Testing

–í—Ä—É—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–Ω–≤–µ—Ä—Å–∏—é:

```bash
curl -X POST "https://api-metrika.yandex.net/management/v1/counter/106602878/offline_conversions/upload" \
  -H "Authorization: OAuth YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "conversions": [
      {
        "ClientID": "123456789",
        "Target": "508977279",
        "DateTime": 1705579200,
        "Price": 0.0,
        "Currency": "RUB"
      }
    ]
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "uploading": {
    "status": "ok",
    "comment": "Conversion uploaded"
  }
}
```

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "Invalid OAuth token"

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é
2. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ OAuth (—Å–º. –®–∞–≥ 2 –≤—ã—à–µ)
3. –û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `sudo systemctl restart dukhovnik-bot`

### –û—à–∏–±–∫–∞: "Goal not found"

**–ü—Ä–æ–±–ª–µ–º–∞:** –¶–µ–ª—å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å—á—ë—Ç—á–∏–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–π–¥–∏—Ç–µ –≤ –ú–µ—Ç—Ä–∏–∫—É ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –¶–µ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID —Ü–µ–ª–µ–π
3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `GOAL_*` –≤ `core/yandex_metrika.py`

### –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ú–µ—Ç—Ä–∏–∫–µ

**–ü—Ä–∏—á–∏–Ω—ã:**
1. **–ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏** - –æ—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –º–æ–≥—É—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –æ—Ç—á—ë—Ç–∞—Ö —á–µ—Ä–µ–∑ 1-2 —á–∞—Å–∞
2. **–ù–µ–≤–µ—Ä–Ω—ã–π ClientID** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `str(user_id)`
3. **–¢–æ–∫–µ–Ω –±–µ–∑ –ø—Ä–∞–≤ `metrika:write`** - –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–∞–º–∏

## üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ

### –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏

```
–ö–ª–∏–∫ –ø–æ —Ä–µ–∫–ª–∞–º–µ (—Å ClientID)
  ‚Üì
bot_start (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ - —Ç–æ—Ç –∂–µ ClientID)
  ‚Üì
free_period_start (–∞–∫—Ç–∏–≤–∞—Ü–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ - —Ç–æ—Ç –∂–µ ClientID)
  ‚Üì
premium_payment (–æ–ø–ª–∞—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏ - —Ç–æ—Ç –∂–µ ClientID)
```

**ClientID —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** ‚Üí –º–æ–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å ROI —Ä–µ–∫–ª–∞–º—ã

### –ö–∞–∫ —Å–º–æ—Ç—Ä–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ

#### 1. –û—Ç—á—ë—Ç –ø–æ –æ—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏—è–º

1. –ó–∞–π–¥–∏—Ç–µ –≤ https://metrika.yandex.ru/dashboard?id=106602878
2. **–û—Ç—á—ë—Ç—ã** ‚Üí **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç—á—ë—Ç—ã** ‚Üí **–ö–æ–Ω–≤–µ—Ä—Å–∏–∏**
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–∏: `bot_start`, `free_period_start`, `premium_payment`
4. –ü–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–π –ø–æ –∫–∞–∂–¥–æ–π —Ü–µ–ª–∏
- –°—É–º–º—É –ø–ª–∞—Ç–µ–∂–µ–π (–¥–ª—è `premium_payment`)
- –ö–æ–Ω–≤–µ—Ä—Å–∏—é (CR) –æ—Ç –∫–ª–∏–∫–æ–≤ –∫ —Ü–µ–ª—è–º

#### 2. –û—Ç—á—ë—Ç –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ç—Ä–∞—Ñ–∏–∫–∞ (UTM)

1. **–û—Ç—á—ë—Ç—ã** ‚Üí **–ò—Å—Ç–æ—á–Ω–∏–∫–∏** ‚Üí **–ú–µ—Ç–∫–∏ UTM**
2. –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É: **utm_source**
3. –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫—É: **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π** ‚Üí `premium_payment`

–í—ã —É–≤–∏–¥–∏—Ç–µ:
- –°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏—à–ª–æ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`yandex`, `vk`, `telegram`, `organic`)
- –°–∫–æ–ª—å–∫–æ –∏–∑ –Ω–∏—Ö –æ–ø–ª–∞—Ç–∏–ª–æ –ø–æ–¥–ø–∏—Å–∫—É
- –ö–æ–Ω–≤–µ—Ä—Å–∏—é source ‚Üí payment
- –°—É–º–º–∞—Ä–Ω—É—é –≤—ã—Ä—É—á–∫—É —Å –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

#### 3. –°–≤—è–∑—å —Ä–µ–∫–ª–∞–º—ã –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–π (ROI)

1. **–û—Ç—á—ë—Ç—ã** ‚Üí **–î–∏—Ä–µ–∫—Ç** ‚Üí **–°–≤–æ–¥–∫–∞**
2. –í–∫–ª—é—á–∏—Ç–µ –∫–æ–ª–æ–Ω–∫–∏:
   - **–ö–ª–∏–∫–∏** - —Å–∫–æ–ª—å–∫–æ –∫–ª–∏–∫–æ–≤ –ø–æ —Ä–µ–∫–ª–∞–º–µ
   - **–†–∞—Å—Ö–æ–¥—ã** - —Å–∫–æ–ª—å–∫–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –Ω–∞ —Ä–µ–∫–ª–∞–º—É
   - **–ö–æ–Ω–≤–µ—Ä—Å–∏–∏** - –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ `premium_payment`
   - **–î–æ—Ö–æ–¥** - —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –æ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–π
   - **ROI** = (–î–æ—Ö–æ–¥ - –†–∞—Å—Ö–æ–¥—ã) / –†–∞—Å—Ö–æ–¥—ã √ó 100%

**–ü—Ä–∏–º–µ—Ä:**
```
–ö–∞–º–ø–∞–Ω–∏—è: "–ü—Ä–∞–≤–æ—Å–ª–∞–≤–Ω—ã–π –±–æ—Ç - –∑–∏–º–∞ 2026"
–ö–ª–∏–∫–∏: 1000
–†–∞—Å—Ö–æ–¥—ã: 10,000 —Ä—É–±
–ö–æ–Ω–≤–µ—Ä—Å–∏–∏ (premium_payment): 20
–î–æ—Ö–æ–¥: 2,980 —Ä—É–± (20 √ó 149 —Ä—É–±)
ROI: -70.2% (—É–±—ã—Ç–æ—á–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è, –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –æ—Ç—á—ë—Ç—ã

1. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º —Ç—Ä–∞—Ñ–∏–∫–∞**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ `utm_source`
   - –ö–∞–∫–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø–ª–∞—Ç—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - ROI –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

2. **–î–∏–Ω–∞–º–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π**
   - –°—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –¥–Ω—è–º/–Ω–µ–¥–µ–ª—è–º/–º–µ—Å—è—Ü–∞–º
   - Goal: `premium_payment` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º Price

3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞**
   - –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –æ–ø–ª–∞—Ç–∏–≤—à–∏—Ö –ø–æ—Å–ª–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
   - –ö–æ–Ω–≤–µ—Ä—Å–∏—è `free_period_start` ‚Üí `premium_payment`

4. **–ö–æ–≥–æ—Ä—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑**
   - –ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –Ω–µ–¥–µ–ª—è–º/–º–µ—Å—è—Ü–∞–º –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ, —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–Ω–∏ –æ–ø–ª–∞—á–∏–≤–∞—é—Ç –ø–æ–¥–ø–∏—Å–∫—É
   - –ù–∞—Ö–æ–¥–∏—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

- **CR (Conversion Rate) start ‚Üí free_period**: —Å–∫–æ–ª—å–∫–æ % –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- **CR free_period ‚Üí payment**: —Å–∫–æ–ª—å–∫–æ % –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ –ø–ª–∞—Ç–Ω—É—é –ø–æ–¥–ø–∏—Å–∫—É –ø–æ—Å–ª–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
- **LTV (Lifetime Value)**: —Å—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
- **CAC (Customer Acquisition Cost)**: —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –ø–ª–∞—Ç—è—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ = –†–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É / –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç—è—â–∏—Ö
- **ROI**: –≤–æ–∑–≤—Ä–∞—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ —Ä–µ–∫–ª–∞–º—É = (–î–æ—Ö–æ–¥ - –†–∞—Å—Ö–æ–¥—ã) / –†–∞—Å—Ö–æ–¥—ã √ó 100%
- **Payback Period**: —á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –ø–ª–∞—Ç–µ–∂–µ–π –æ–∫—É–ø–∞–µ—Ç—Å—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ `.env` —Ñ–∞–π–ª **–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è** –≤ git (–≤ `.gitignore`)
- ‚úÖ –¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö API

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –û—Ñ—Ñ–ª–∞–π–Ω-–∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (`asyncio.create_task`)
- –°–±–æ–∏ API –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
- ClientID = Telegram user_id (—Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- –ö–æ–Ω–≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ú–µ—Ç—Ä–∏–∫–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–æ 2 —á–∞—Å–æ–≤
